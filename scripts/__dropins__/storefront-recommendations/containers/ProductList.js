/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as t,jsxs as A,Fragment as _}from"@dropins/tools/preact-jsx-runtime.js";import{useState as U,useRef as M,useCallback as V,useEffect as C}from"@dropins/tools/preact-compat.js";import{ContentGrid as H,Skeleton as J,SkeletonRow as K,ProductItemCard as Q,Button as X,Price as Y,Image as Z}from"@dropins/tools/components.js";import{classes as D,VComponent as ee,Slot as h}from"@dropins/tools/lib.js";import{events as te}from"@dropins/tools/event-bus.js";import{p as ne,g as re,a as oe,b as ie}from"../chunks/getRecommendations.js";import{useText as ce}from"@dropins/tools/i18n.js";import"../fragments.js";import"../chunks/initialize.js";import"@dropins/tools/fetch-graphql.js";const ae=({className:m,children:f,heading:v,products:u=null,loading:g=!0,...b})=>t("section",{...b,role:"region","aria-label":"Product recommendations",className:D(["recommendations-product-list",m,["recommendations-product-list--empty",!u]]),children:g?t(de,{}):A(_,{children:[v&&t(ee,{node:v,className:"recommendations-product-list__heading"}),t(H,{className:"recommendations-product-list__content","data-testid":"recommendations-product-list__content",maxColumns:0,columnWidth:"minmax(240px, 1fr)",children:u})]})}),de=()=>t(J,{"data-testid":"recommendations-product-list-skeleton",className:"recommendations-product-list-skeleton",rowGap:"medium",children:[...Array(2)].map((m,f)=>t(K,{variant:"row",size:"large",fullWidth:!0,lines:2,multilineGap:"small"},f))}),Re=({recId:m,initialData:f=null,hideHeading:v,routeProduct:u,currentSku:g,cartSkus:b,userPurchaseHistory:k,userViewHistory:x,pagePlacement:N,slots:o,...E})=>{var B,O,L;const[S,R]=U(!f),[r,y]=U((B=f==null?void 0:f.recommendations)!=null&&B.results?f.recommendations.results.filter(e=>e.unitId===m):[]),p=M(null),P=ce({addToCartText:"Recommendations.ProductList.addToCart",optionsText:"Recommendations.ProductList.selectOptions",viewProductText:"Recommendations.ProductList.viewProduct"}),T=V(()=>!!m&&!!g,[m,g]);if(C(()=>{const e=te.on("recommendations/data",c=>{c&&c.length>0&&y(a=>{const n=a||[],d=c.filter(i=>{var l;return(i==null?void 0:i.unitId)===m&&((l=i==null?void 0:i.items)==null?void 0:l.length)&&!n.some(s=>s.unitId===i.unitId)});return d.forEach(i=>{var l,s;ne({recommendationUnit:i,pagePlacement:"product-list",yOffsetTop:((l=p.current)==null?void 0:l.getBoundingClientRect().top)??0,yOffsetBottom:((s=p.current)==null?void 0:s.getBoundingClientRect().bottom)??0,backupProducts:0,searchTime:0})}),[...n,...d]}),R(!1)});return()=>{e==null||e.off()}},[m]),C(()=>{if(!(r!=null&&r.length)||!p.current)return;const e={root:null,rootMargin:"0px",threshold:.5},c=n=>{n.forEach(d=>{d.intersectionRatio>.5&&r.forEach(i=>{var l,s;oe({recommendationUnit:i,pagePlacement:"product-list",yOffsetTop:((l=p.current)==null?void 0:l.getBoundingClientRect().top)??0,yOffsetBottom:((s=p.current)==null?void 0:s.getBoundingClientRect().bottom)??0})})})},a=new IntersectionObserver(c,e);return a.observe(p.current),()=>a.disconnect()},[r]),C(()=>{if(!T()){R(!1);return}R(!0),re({currentSku:g,pageType:"Product",cartSkus:b,userPurchaseHistory:k,userViewHistory:x,recId:m}).catch(e=>{console.error("Recommendations error:",e),y([]),R(!1)})},[g,b,k,x,T,m]),!T())return m||console.warn("ProductList: recId is missing. Please provide a valid recId to display product recommendations."),g||console.warn("ProductList: currentSku is missing. Please provide a valid currentSku to display product recommendations."),null;const F=(e,c)=>{var d,i,l,s;const a={loading:c<4?"eager":"lazy",src:((i=(d=e.images)==null?void 0:d[0])==null?void 0:i.url)||"",alt:((s=(l=e.images)==null?void 0:l[0])==null?void 0:s.label)||"",width:"300",height:"300",params:{width:300}},n=t(Z,{"data-testid":"product-list-item-image",...a,"aria-label":e.sku});return t(h,{name:"Thumbnail",slot:o==null?void 0:o.Thumbnail,context:{item:e,defaultImageProps:a},children:u?t("a",{href:u(e),children:n}):n})},I=t(h,{name:"Heading",slot:o==null?void 0:o.Heading,context:{},children:t("div",{"data-testid":"default-product-list-heading",children:((O=r==null?void 0:r[0])==null?void 0:O.title)||P.heading})}),z=(e,c)=>t(h,{name:"Footer",slot:o==null?void 0:o.Footer,context:{item:e,index:c},children:t("div",{"data-testid":"default-product-list-footer",children:u&&t("a",{href:u(e),children:t(X,{"data-testid":"default-product-list-footer-button",children:P.viewProductText,"aria-label":P.viewProductText,variant:"primary"})})})}),G=e=>t(h,{name:"Title",slot:o==null?void 0:o.Title,context:{item:e,productUrl:u?u(e):""},children:u?t("a",{href:u(e),children:e.name}):t("span",{children:e.name})}),$=e=>t(h,{name:"Sku",slot:o==null?void 0:o.Sku,context:{item:e},children:t("span",{children:e.sku})}),j=e=>{var c,a,n,d;return t(h,{name:"Price",slot:o==null?void 0:o.Price,context:{item:e},children:t("div",{"data-testid":"default-product-price",children:t(Y,{amount:((a=(c=e.price.final)==null?void 0:c.amount)==null?void 0:a.value)??void 0,currency:((d=(n=e.price.final)==null?void 0:n.amount)==null?void 0:d.currency)??void 0})})})},W=(e,c)=>{var n,d;const a=r==null?void 0:r.find(i=>{var l;return(l=i.items)==null?void 0:l.some(s=>s.sku===e.sku)});a&&ie({recommendationUnit:a,pagePlacement:N||"",yOffsetTop:((n=p.current)==null?void 0:n.getBoundingClientRect().top)??0,yOffsetBottom:((d=p.current)==null?void 0:d.getBoundingClientRect().bottom)??0,productId:c})},q=(L=r==null?void 0:r[0])!=null&&L.totalProducts?t(_,{children:r==null?void 0:r.map(({items:e,totalProducts:c},a)=>c>0?e.map((n,d)=>{const{sku:i}=n;return t("span",{role:"group","aria-label":`Product ${a*e.length+d+1} of ${c}`,onClick:()=>W(n,0),children:t(Q,{"data-testid":"recommendations-product-item-card",initialized:!0,sku:$(n),image:F(n,a*e.length+d),titleNode:G(n),price:j(n),actionButton:z(n,a*e.length+d)})},i)}):null)}):null,w=!r||r.length===0||r.every(e=>!e.items||e.items.length===0);return t("div",{ref:p,children:t(ae,{...E,className:w?"recommendations-product-list--empty":"",heading:v?void 0:I,loading:S,products:w?null:q})})};export{Re as ProductList,Re as default};
//# sourceMappingURL=ProductList.js.map
