/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as f,jsxs as $}from"@dropins/tools/preact-jsx-runtime.js";import{Slot as mr,classes as Fr}from"@dropins/tools/lib.js";import"@dropins/tools/event-bus.js";import"@dropins/tools/recaptcha.js";import{g as Pr,c as Er,a as br}from"./createCustomerAddress.js";import{useState as p,useEffect as Nr,useCallback as C,useMemo as _r}from"@dropins/tools/preact-hooks.js";import{s as nr,b as Lr}from"./simplifyTransformAttributesForm.js";import{v as yr,u as Mr,a as Ur}from"./usePasswordValidationMessage.js";import{a as Cr}from"./getCustomerToken.js";import{p as Sr,E as xr}from"./acdl.js";import{c as O,g as Tr,u as qr,B as ur}from"./Button2.js";import{c as vr}from"./transform-attributes-form.js";import{f as dr,E as Ar}from"./focusOnEmptyPasswordField.js";import{Header as Br,InLineAlert as Kr,InputPassword as cr,Field as jr,Checkbox as Ir}from"@dropins/tools/components.js";import{u as Gr,F as Hr}from"./Button.js";import{S as Vr}from"./SkeletonLoader.js";const fr=(m,e)=>e!=null&&e.length?m.map(r=>{var d;const t=(d=e.find(({code:s})=>s===r.code))==null?void 0:d.defaultValue;return t?{...r,defaultValue:t}:r}):m,Wr=({inputsDefaultValueSet:m,fieldsConfigForApiVersion1:e,apiVersion2:r})=>{const[t,d]=p([]);return Nr(()=>{(async()=>{if(r){const o=await Pr("customer_account_create");if(o!=null&&o.length)if(m!=null&&m.length){const b=fr(o,m);d(b)}else d(o)}else{const o=nr(Lr),b=nr(e),_=fr(o,m);d(e&&e.length?b:_)}})()},[r,e,m]),{fieldsListConfigs:t.map(s=>({...s,...s.code==="email"?{autocomplete:"username"}:{}}))}},$r=(m,e)=>{const r=["dob","email","firstname","gender","lastname","middlename","password","prefix","suffix","taxvat"],t=vr(m,"snakeCase",{firstName:"firstname",lastName:"lastname"});if(!e)return{...t,...t!=null&&t.gender?{gender:Number(t==null?void 0:t.gender)}:{}};const d={},s=[];return Object.keys(t).forEach(o=>{r.includes(o)?d[o]=o.includes("gender")?Number(t[o]):t[o]:s.push({attribute_code:o,value:t[o]})}),s.length>0&&(d.custom_attributes=s),d},Or=({requireRetypePassword:m,addressesData:e,translations:r,isEmailConfirmationRequired:t,apiVersion2:d=!0,passwordConfigs:s,isAutoSignInEnabled:o,routeRedirectOnSignIn:b,routeSignIn:_,onErrorCallback:S,onSuccessCallback:g,setActiveComponent:F,handleSetInLineAlertProps:P,routeRedirectOnEmailConfirmationClose:T})=>{const[h,n]=p(!1),[i,I]=p(""),[q,u]=p(""),[G,v]=p(""),[J,H]=p(!1),[Q,A]=p({userName:"",status:!1}),[l,x]=p(""),[X,V]=p(!1),[W,L]=p(!1),[Y,Z]=p(!0),k=C(a=>{const w=a.target.value;n(!w.length),w.length&&i.length&&w!==i&&u(r.passwordMismatch)},[i,r.passwordMismatch]),z=C(a=>{const w=a.target.value;u(w.length?"":r.requiredFieldError),w.length&&l.length&&w!==l&&u(r.passwordMismatch)},[l,r.passwordMismatch,r.requiredFieldError]),D=C(a=>{I(a),u(a?l===a?"":r.passwordMismatch:r.requiredFieldError)},[r,l]),R=C(({target:a})=>{Z(a.checked)},[]),rr=C(()=>{if(O(F)){F("signInForm");return}O(_)&&(window.location.href=_())},[F,_]),B=C(a=>{x(a),n(!a.length),a===i&&u("")},[i]),E=C(()=>{P(),x(""),O(T)?window.location.href=T():(H(!1),F==null||F("signInForm"))},[P,T,F]),K=()=>{V(!0),L(!1)},er=(a,w)=>{const tr=l.length&&i.length,j=l!==i,y=()=>{n(!l.length),i||u(r.requiredFieldError),tr&&j&&u(r.passwordMismatch)},M=()=>{u(i.length?r.passwordMismatch:r.requiredFieldError),dr(a,l,i)};return w?m&&(q.length||j)?(K(),M(),!0):(dr(a,l,""),y(),!1):(K(),y(),!0)};return{showPasswordErrorMessage:h,confirmPassword:i,confirmPasswordMessage:q,isKeepMeLogged:Y,userEmail:G,showEmailConfirmationForm:J,isSuccessful:Q,isClickSubmit:X,signUpPasswordValue:l,isLoading:W,onSubmitSignUp:async(a,w)=>{var sr,or,ir;if(P(),u(""),L(!0),er(a,w))return;const{confirmPasswordField:tr,...j}=Tr(a.target),{email:y,password:M}=j,hr=(s==null?void 0:s.requiredCharacterClasses)||0,gr=(s==null?void 0:s.minLength)||1;if(!yr(M,hr)||gr>(M==null?void 0:M.length)){K();return}const wr=$r({...j},d),N=await Er(wr,d);if((sr=N==null?void 0:N.errors)!=null&&sr.length){const{errors:U}=N;P==null||P({type:"error",text:(or=U[0])==null?void 0:or.message}),S==null||S(U),v(y)}else{const U=N==null?void 0:N.firstName;if(Sr(xr.CREATE_ACCOUNT_EVENT,{...N}),t||!o){if(g==null||g({userName:U,userEmail:y,status:!0}),t){(ir=a.target)==null||ir.reset(),x(""),H(!0),v(y),L(!1);return}if(!o){L(!1),A({userName:U,status:!0});return}}const c=await Cr({email:y,password:M,translations:r,handleSetInLineAlertProps:P,onErrorCallback:S});if(c!=null&&c.userName){if(e!=null&&e.length)for(const ar of e)try{await br(ar)}catch(pr){console.error(r.failedCreateCustomerAddress,ar,pr)}g==null||g({userName:c==null?void 0:c.userName,userEmail:c==null?void 0:c.userEmail,status:!0}),O(b)?window.location.href=b():A({userName:c==null?void 0:c.userName,status:!0})}else g==null||g({userName:U,userEmail:c==null?void 0:c.userEmail,status:!0}),A({userName:U,status:!0})}L(!1)},signInButton:rr,handleSetSignUpPasswordValue:B,onKeepMeLoggedChange:R,handleHideEmailConfirmationForm:E,handleConfirmPasswordChange:D,onBlurPassword:k,onBlurConfirmPassword:z}},me=({requireRetypePassword:m=!1,addressesData:e,formSize:r="default",inputsDefaultValueSet:t,fieldsConfigForApiVersion1:d,apiVersion2:s=!0,isAutoSignInEnabled:o=!0,hideCloseBtnOnEmailConfirmation:b=!1,routeRedirectOnEmailConfirmationClose:_,routeRedirectOnSignIn:S,routeSignIn:g,onErrorCallback:F,onSuccessCallback:P,setActiveComponent:T,slots:h})=>{const n=Gr({title:"Auth.SignUpForm.title",buttonPrimary:"Auth.SignUpForm.buttonPrimary",buttonSecondary:"Auth.SignUpForm.buttonSecondary",keepMeLoggedText:"Auth.SignUpForm.keepMeLoggedText",customerTokenErrorMessage:"Auth.Api.customerTokenErrorMessage",failedCreateCustomerAddress:"Auth.SignUpForm.failedCreateCustomerAddress",placeholder:"Auth.InputPassword.placeholder",floatingLabel:"Auth.InputPassword.floatingLabel",requiredFieldError:"Auth.FormText.requiredFieldError.default",confirmPasswordPlaceholder:"Auth.SignUpForm.confirmPassword.placeholder",confirmPasswordFloatingLabel:"Auth.SignUpForm.confirmPassword.floatingLabel",passwordMismatch:"Auth.SignUpForm.confirmPassword.passwordMismatch"}),{passwordConfigs:i,isEmailConfirmationRequired:I}=Mr(),{fieldsListConfigs:q}=Wr({fieldsConfigForApiVersion1:d,apiVersion2:s,inputsDefaultValueSet:t}),{inLineAlertProps:u,handleSetInLineAlertProps:G}=qr(),{showPasswordErrorMessage:v,confirmPassword:J,confirmPasswordMessage:H,isKeepMeLogged:Q,userEmail:A,showEmailConfirmationForm:l,isSuccessful:x,isClickSubmit:X,signUpPasswordValue:V,isLoading:W,onSubmitSignUp:L,signInButton:Y,handleSetSignUpPasswordValue:Z,onKeepMeLoggedChange:k,handleHideEmailConfirmationForm:z,handleConfirmPasswordChange:D,onBlurPassword:R,onBlurConfirmPassword:rr}=Or({requireRetypePassword:m,addressesData:e,translations:n,isEmailConfirmationRequired:I,apiVersion2:s,passwordConfigs:i,isAutoSignInEnabled:o,routeRedirectOnSignIn:S,routeSignIn:g,onErrorCallback:F,onSuccessCallback:P,setActiveComponent:T,handleSetInLineAlertProps:G,routeRedirectOnEmailConfirmationClose:_}),{isValidUniqueSymbols:B,defaultLengthMessage:E}=Ur({password:V,isClickSubmit:X,passwordConfigs:i}),K=_r(()=>v?n.requiredFieldError:B==="error"||(E==null?void 0:E.status)==="error"?" ":"",[E==null?void 0:E.status,B,v,n.requiredFieldError]),er=!I&&(e==null?void 0:e.length);return!q.length&&s?f("div",{className:`auth-sign-up-form auth-sign-up-form--${r} skeleton-loader`,"data-testid":"SignUpForm",children:f(Vr,{activeSkeleton:"signUpForm"})}):x.status&&(h!=null&&h.SuccessNotification)?f(mr,{"data-testid":"successNotificationTestId",name:"SuccessNotification",slot:h==null?void 0:h.SuccessNotification,context:{isSuccessful:x}}):l?f(Ar,{formSize:r,userEmail:A,inLineAlertProps:u,hideCloseBtnOnEmailConfirmation:b,handleSetInLineAlertProps:G,onPrimaryButtonClick:z}):$("div",{className:Fr(["auth-sign-up-form",`auth-sign-up-form--${r}`]),"data-testid":"SignUpForm",children:[f(Br,{title:n.title,divider:!1,className:"auth-sign-up-form__title"}),u.text?f(Kr,{className:"auth-sign-up-form__notification",type:u.type,variant:"secondary",heading:u.text,icon:u.icon}):null,$(Hr,{onSubmit:L,className:"auth-sign-up-form__form",loading:W,name:"signUp_form",fieldsConfig:q,slots:h,children:[$(cr,{validateLengthConfig:E,className:"auth-sign-up-form__form__field",autoComplete:"current-password",name:"password",minLength:i==null?void 0:i.minLength,errorMessage:K,defaultValue:V,uniqueSymbolsStatus:B,requiredCharacterClasses:i==null?void 0:i.requiredCharacterClasses,onValue:Z,placeholder:n.placeholder,floatingLabel:n.floatingLabel,onBlur:R,children:[m?f("div",{className:"auth-sign-up-form__form__confirm-wrapper",children:f(cr,{className:"auth-sign-up-form__form__field auth-sign-up-form__form__field--confirm-password",autoComplete:"confirmPassword",name:"confirmPasswordField",placeholder:n.confirmPasswordPlaceholder,floatingLabel:n.confirmPasswordFloatingLabel,errorMessage:H,defaultValue:J,onValue:D,onBlur:rr})}):null,er?f("div",{className:"auth-sign-up-form__automatic-login","data-testid":"automaticLogin",children:f(jr,{children:f(Ir,{name:"",placeholder:n.keepMeLoggedText,label:n.keepMeLoggedText,checked:Q,onChange:k})})}):null]}),f(mr,{name:"PrivacyPolicyConsent","data-testid":"privacyPolicyConsent",slot:h==null?void 0:h.PrivacyPolicyConsent},"privacyPolicyConsent"),$("div",{className:"auth-sign-up-form-buttons",children:[f(ur,{className:"auth-sign-up-form-buttons--signin",type:"button",variant:"tertiary",style:{padding:0},buttonText:n.buttonSecondary,enableLoader:!1,onClick:Y}),f(ur,{type:"submit",buttonText:n.buttonPrimary,variant:"primary",enableLoader:W})]})]}),f("div",{id:"createCustomerV2"})]})};export{me as S};
