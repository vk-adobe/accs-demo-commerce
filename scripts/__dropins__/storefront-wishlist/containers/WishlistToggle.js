/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as h}from"@dropins/tools/preact-jsx-runtime.js";import{useState as c,useCallback as E,useEffect as I}from"@dropins/tools/preact-compat.js";import{Button as F,Icon as d}from"@dropins/tools/components.js";import{events as a}from"@dropins/tools/event-bus.js";import{s as P,g as j,i as x,r as A}from"../chunks/removeProductsFromWishlist.js";import{c as M,a as R}from"../chunks/mergeWishlists.js";import{S as p}from"../chunks/HeartFilled.js";import{S as q}from"../chunks/Heart.js";import{useText as H}from"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";import"@dropins/tools/lib.js";const Z=({product:s,iconWishlisted:W,iconToWishlist:g,size:u,variant:D,disabled:U,labelToWishlist:k,labelWishlisted:w,onClick:O,removeProdFromCart:f})=>{const[b,L]=c(P.authenticated),[o,n]=c(!1),[r,S]=c(null),{isGuestWishlistEnabled:T}=M.getConfig(),v=H({addToWishlist:"Wishlist.Wishlist.ariaLabelAddToWishlist",removeFromWishlist:"Wishlist.Wishlist.ariaLabelRemoveFromWishlist"}),l=E(()=>{var t;const e=j(),i=(t=e==null?void 0:e.items)==null?void 0:t.find(m=>x(m,{sku:s.topLevelSku??s.sku,optionUIDs:s.optionUIDs??(s.selectedOptionsUIDs?Object.values(s.selectedOptionsUIDs):void 0)}));S(i??null),n(!!i)},[s.topLevelSku,s.sku,s.optionUIDs,s.selectedOptionsUIDs]);I(()=>{l()},[l]),I(()=>{const e=m=>L(m),i=a.on("authenticated",e),t=a.on("wishlist/data",l);return()=>{i==null||i.off(),t==null||t.off()}},[l]);const y=async()=>{var e;if(o){try{await A([r])}catch{return a.emit("wishlist/alert",{action:"removeError",item:r}),null}n(!1),a.emit("wishlist/alert",{action:"remove",item:r})}else{try{await R([{sku:s.topLevelSku??s.sku,quantity:1,optionsUIDs:s.optionUIDs??(s.selectedOptionsUIDs?Object.values(s.selectedOptionsUIDs):void 0),enteredOptions:(e=s.options)!=null&&e.items?s.options.items.filter(i=>i.selected).map(i=>({uid:i.uid,value:i.value})):void 0}])}catch{return a.emit("wishlist/alert",{action:"addError"}),null}n(!0),a.emit("wishlist/alert",{action:"add",item:{product:s}}),f&&await f([{uid:s.uid,quantity:0}])}};if(!b&&!T)return null;const C=o?v.removeFromWishlist.replace("{PRODUCT_NAME}",s==null?void 0:s.name):v.addToWishlist.replace("{PRODUCT_NAME}",s==null?void 0:s.name);return h(F,{active:o,"aria-label":C,"data-testid":"wishlist-toggle",size:u??"medium",variant:D??"tertiary",disabled:U,icon:h(d,{source:g??q}),activeIcon:h(d,{source:W??p}),onClick:O??y,children:k,activeChildren:w})};export{Z as WishlistToggle,Z as default};
